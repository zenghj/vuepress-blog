(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{508:function(t,a,n){t.exports=n.p+"assets/img/onbeforeunload_comp.2c4a00cc.png"},509:function(t,a,n){t.exports=n.p+"assets/img/onbeforeunload_confirm.de31fa7e.png"},556:function(t,a,n){"use strict";n.r(a);var s=n(9),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现方式"}},[t._v("#")]),t._v(" 实现方式")]),t._v(" "),s("h3",{attrs:{id:"onbeforeunload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#onbeforeunload"}},[t._v("#")]),t._v(" onbeforeunload")]),t._v(" "),s("p",[t._v("https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onbeforeunload")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onbeforeunload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  e "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 兼容IE8和Firefox 4之前的版本")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("returnValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'关闭提示'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Chrome, Safari, Firefox 4+, Opera 12+ , IE 9+")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'关闭提示'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("需要注意的是：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("从2011年5月25日起,  HTML5 规范 声明:在该事件的处理函数中调用下列弹窗相关的方法时,可以忽略不执行,window.showModalDialog(), window.alert(), window.confirm() window.prompt().")])]),t._v(" "),s("li",[s("p",[t._v("需要指出的是，许多浏览器会忽略该事件并自动关闭页面无需用户的确认。火狐浏览器在配置页面about:config设有一个dom.disable_beforeunload的开关变量用于开启这个功能.")])]),t._v(" "),s("li",[s("p",[t._v("在Firefox4及其后续版本中,返回的说明字符串并不向用户显示,也就是无法自定义说明字符串.")])])]),t._v(" "),s("h3",{attrs:{id:"兼容性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#兼容性"}},[t._v("#")]),t._v(" 兼容性")]),t._v(" "),s("p",[s("img",{attrs:{src:n(508),alt:"onbeforeunload_comp"}})]),t._v(" "),s("p",[t._v("移动端兼容性存在问题, 返回的特定说明字符串也不一定能展示给用户")]),t._v(" "),s("p",[t._v("实测：")]),t._v(" "),s("p",[t._v("移动端\nAndroid Chrome 正常出现提示弹窗\nAndroid Mi Browser v11.2.4-g "),s("code",[t._v("<a>")]),t._v("链接跳转不出现提示弹窗，刷新页面时会出现弹窗\nIOS Safari 完全没有弹窗")]),t._v(" "),s("p",[t._v("PC端-macOS 10.14.6\nChrome 正常出现提示弹窗\nSafari 完全没有弹窗\nFirefox 正常出现弹窗")]),t._v(" "),s("p",[t._v("另外，在PC chrome上没有用户行为的情况下是无法阻止用户离开的。")]),t._v(" "),s("blockquote",[s("p",[t._v("[Intervention] Blocked attempt to show a 'beforeunload' confirmation panel for a frame that never had a user gesture since its load.")])]),t._v(" "),s("h3",{attrs:{id:"能不能自定义弹窗内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#能不能自定义弹窗内容"}},[t._v("#")]),t._v(" 能不能自定义弹窗内容？")]),t._v(" "),s("p",[t._v("在Chrome中离开时会出现如下弹窗")]),t._v(" "),s("p",[s("img",{attrs:{src:n(509),alt:"onbeforeunload_confirm"}})]),t._v(" "),s("p",[t._v("能不能自定义弹窗内容？答案是不能，除了部分浏览器可能会展示onbeforeunload回调中可能返回的字符串。")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("通过onbeforeunload实现拦截用户离开页面的行为在PC和移动端都存在兼容性问题, 且无法实现自定义弹窗显示内容。但是对于单页面应用，在应用内跳转则是可以通过router的钩子进行自定义确认弹窗提示的。")])])}),[],!1,null,null,null);a.default=e.exports}}]);